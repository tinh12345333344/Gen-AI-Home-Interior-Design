version: '3.8'

services:
  # âš™ï¸ Service for the FastAPI Backend
  backend:
    container_name: gen-ai-designer-backend
    build:
      context: ./backend # Giáº£ sá»­ Dockerfile cho backend náº±m trong thÆ° má»¥c 'backend'
      dockerfile: Dockerfile
    # image: your-backend-image:latest # CÃ³ thá»ƒ dÃ¹ng image náº¿u Ä‘Ã£ build sáºµn
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    env_file:
      - ./backend/.env # Táº£i biáº¿n mÃ´i trÆ°á»ng (bao gá»“m GEMINI_API_KEY) tá»« file .env
    ports:
      - "8000:8000" # Má»Ÿ cá»•ng 8000 trÃªn host, map tá»›i cá»•ng 8000 cá»§a container
    volumes:
      - ./backend:/app # Mount thÆ° má»¥c backend vÃ o container Ä‘á»ƒ há»— trá»£ --reload (phÃ¡t triá»ƒn)
      - /app/poetry.lock # TrÃ¡nh mount Ä‘Ã¨ lÃªn file lock
    restart: always
    # networks:
    #   - gen-ai-network

  # ğŸ–¥ï¸ Service for the React Frontend
  frontend:
    container_name: gen-ai-designer-frontend
    build:
      context: ./frontend # Giáº£ sá»­ Dockerfile cho frontend náº±m trong thÆ° má»¥c 'frontend'
      dockerfile: Dockerfile
    # image: your-frontend-image:latest # CÃ³ thá»ƒ dÃ¹ng image náº¿u Ä‘Ã£ build sáºµn
    ports:
      - "3000:3000" # Má»Ÿ cá»•ng 3000 trÃªn host, map tá»›i cá»•ng 3000 cá»§a container (port máº·c Ä‘á»‹nh cá»§a React Dev Server)
    volumes:
      - ./frontend:/app # Mount thÆ° má»¥c frontend vÃ o container (phÃ¡t triá»ƒn)
      - /app/node_modules # Loáº¡i trá»« node_modules Ä‘á»ƒ trÃ¡nh lá»—i permission/tá»‘c Ä‘á»™ cháº­m
    depends_on:
      - backend # Äáº£m báº£o backend khá»Ÿi Ä‘á»™ng trÆ°á»›c hoáº·c cÃ¹ng lÃºc
    restart: always
    # networks:
    #   - gen-ai-network

# # ğŸŒ Docker Networks (TÃ¹y chá»n)
# networks:
#   gen-ai-network:
#     driver: bridge

# GHI CHÃš QUAN TRá»ŒNG:
# 1. Báº¡n cáº§n táº¡o má»™t file **Dockerfile** riÃªng cho thÆ° má»¥c 'backend' vÃ  'frontend'
#    Ä‘á»ƒ Docker Compose cÃ³ thá»ƒ build image.
# 2. File `.env` chá»©a `GEMINI_API_KEY` pháº£i náº±m trong thÆ° má»¥c **backend**.
